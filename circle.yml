---
deployment:
  release:
    tag: /[0-9]+(\.[0-9]+){2}(-[0-9]+)?/
    owner: klingtnet 
    commands:
      - go get github.com/aktau/github-release
      - go run download-caddy.go $CIRCLE_TAG
      - github-release release --user klingtnet --repo caddy-release-downloader --tag $CIRCLE_TAG --name $CIRCLE_TAG --pre-release
      - github-release upload --user $CIRCLE_PROJECT_USERNAME --repo $CIRCLE_PROJECT_REPONAME --tag $CIRCLE_TAG --name caddy-all-plugins-${CIRCLE_TAG}-amd64.tar.gz --file caddy-all-plugins-${CIRCLE_TAG}-amd64.tar.gz
      - github-release upload --user $CIRCLE_PROJECT_USERNAME --repo $CIRCLE_PROJECT_REPONAME --tag $CIRCLE_TAG --name caddy-all-plugins-${CIRCLE_TAG}-386.tar.gz --file caddy-all-plugins-${CIRCLE_TAG}-386.tar.gz
      - github-release upload --user $CIRCLE_PROJECT_USERNAME --repo $CIRCLE_PROJECT_REPONAME --tag $CIRCLE_TAG --name caddy-all-plugins-${CIRCLE_TAG}-arm.tar.gz --file caddy-all-plugins-${CIRCLE_TAG}-arm.tar.gz
      - github-release upload --user $CIRCLE_PROJECT_USERNAME --repo $CIRCLE_PROJECT_REPONAME --tag $CIRCLE_TAG --name caddy-all-plugins-${CIRCLE_TAG}-arm6.tar.gz --file caddy-all-plugins-${CIRCLE_TAG}-arm.tar.gz
